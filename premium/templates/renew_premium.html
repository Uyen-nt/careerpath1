{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% block title %}{{ page_title }} - CareerPath{% endblock %}

{% block content %}
<head>
  <link rel="stylesheet" href="{% static 'css/premium.css' %}">
  <!-- Tải CSS cho trang gia hạn -->
  <link rel="stylesheet" href="{% static 'css/renew-premium.css' %}">
</head>

<section class="premium-section py-5">
  <div class="container">
    <div class="row justify-content-center text-center mb-5">
      <div class="col-xl-8 col-lg-9">
        <h2 class="section-title fw-bolder mb-2">
          {% if is_first_time %}Chọn Gói Premium Phù Hợp{% else %}Gia Hạn Premium{% endif %}
        </h2>
        <p class="text-muted lead-line mb-0">
          {{ hero_subtitle }}
        </p>
      </div>
    </div>

    <!-- Bố cục 2 cột -->
    <div class="row align-items-start justify-content-center">
      
      <!-- Cột 1: Lợi ích (Giữ nguyên) -->
      <div class="col-lg-6 col-md-12 mb-5 mb-lg-0">
        <div class="feature-description">
          <h3 class="fw-bold mb-4">Những gì bạn sẽ nhận được</h3>
          <ul class="list-unstyled">
            <li class="d-flex mb-4">
              <div class="feature-icon me-3"><i class="bi bi-person-check-fill"></i></div>
              <div>
                <h5 class="fw-bold">Hiểu rõ bản thân</h5>
                <p class="text-muted">Khám phá tính cách, sở thích, năng lực tiềm ẩn qua hệ thống câu hỏi chuyên sâu.</p>
              </div>
            </li>
            <li class="d-flex mb-4">
              <div class="feature-icon me-3"><i class="bi bi-graph-up-arrow"></i></div>
              <div>
                <h5 class="fw-bold">Đón đầu xu hướng</h5>
                <p class="text-muted">Phân tích ngành nghề hot, kỹ năng cần thiết để bạn đi trước một bước.</p>
              </div>
            </li>
            <li class="d-flex mb-4">
                <div class="feature-icon me-3"><i class="bi bi-unlock-fill"></i></div>
                <div>
                  <h5 class="fw-bold">Truy cập toàn bộ tính năng</h5>
                  <p class="text-muted">Mở khóa tất cả báo cáo, gợi ý nghề nghiệp và lộ trình phát triển chi tiết.</p>
                </div>
              </li>
          </ul>
        </div>
      </div>

      <!-- Cột 2: Form lựa chọn gói -->
      <div class="col-lg-5 col-md-8">
        <div class="pricing-card">
          <div class="card-body p-4 p-lg-5">

            <form id="renew-form" method="post" novalidate>
              {% csrf_token %}
              
              <!-- Thông tin người dùng (không cần chỉnh sửa) -->
              <div class="user-info-display">
                <p><span class="text-muted">Tài khoản:</span> <strong>{{ user.first_name }} {{ user.last_name }}</strong></p>
                <p><span class="text-muted">Email:</span> <strong>{{ user.email }}</strong></p>
              </div>

              <!-- Lựa chọn gói -->
              <div id="plan-options" class="plan-options-group">
                
                <!-- Gói 1 Tháng -->
                <label for="plan-1" class="plan-option" data-price="39000">
                  <input type="radio" id="plan-1" name="months" value="1" checked>
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <div class="plan-title">1 Tháng</div>
                      <div class="plan-savings text-white">.</div> <!-- Placeholder để giữ chiều cao -->
                    </div>
                    <div class="plan-price text-end">39,000₫</div>
                  </div>
                </label>

                <!-- Gói 6 Tháng -->
                <label for="plan-6" class="plan-option" data-price="199000">
                  <input type="radio" id="plan-6" name="months" value="6">
                   <div class="best-value-badge">Tiết kiệm</div>
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <div class="plan-title">6 Tháng</div>
                      <div class="plan-savings">Tiết kiệm 15%</div>
                    </div>
                    <div class="plan-price text-end">199,000₫</div>
                  </div>
                </label>

                <!-- Gói 12 Tháng -->
                <label for="plan-12" class="plan-option" data-price="349000">
                  <input type="radio" id="plan-12" name="months" value="12">
                   <div class="best-value-badge">Giá tốt nhất</div>
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <div class="plan-title">12 Tháng</div>
                      <div class="plan-savings">Tiết kiệm 25%</div>
                    </div>
                    <div class="plan-price text-end">349,000₫</div>
                  </div>
                </label>

              </div>

              <div class="d-grid mt-4">
                <button type="submit" class="btn btn-warning btn-lg fw-bold shadow-sm">
                  <span id="cta-button-text">Thanh toán 39,000₫</span>
                </button>
              </div>

              <p class="text-muted small text-center mt-3 mb-0">
                <i class="bi bi-shield-check"></i> Thanh toán một lần, an toàn và bảo mật.
              </p>
            </form>

          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('renew-form');
    const options = form.querySelectorAll('.plan-option');
    const ctaButtonText = document.getElementById('cta-button-text');
    const ctaLabel = "{{ cta_label }}"; // Ví dụ: "Tiến tới thanh toán"

    function updateSelection() {
        let selectedOption = null;
        options.forEach(opt => {
            const radio = opt.querySelector('input[type="radio"]');
            if (radio.checked) {
                opt.classList.add('selected');
                selectedOption = opt;
            } else {
                opt.classList.remove('selected');
            }
        });
        
        // Cập nhật nút bấm
        if (selectedOption) {
            const price = parseInt(selectedOption.dataset.price, 10);
            const formattedPrice = price.toLocaleString('vi-VN') + '₫';
            ctaButtonText.textContent = `${ctaLabel} ${formattedPrice}`;
        }
    }

    // Thêm event listener cho từng option
    options.forEach(option => {
        option.addEventListener('click', function() {
            // Cập nhật trạng thái radio và giao diện
            this.querySelector('input[type="radio"]').checked = true;
            updateSelection();
        });
    });

    // Cập nhật lần đầu khi tải trang
    updateSelection();
});
</script>
{% endblock %}