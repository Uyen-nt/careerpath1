{% extends 'base.html' %}
{% load static %}
{% block title %}Xu h∆∞·ªõng th·ªã tr∆∞·ªùng - CareerPath{% endblock %}

{% block content %}
{# --- N·∫°p Font & Th∆∞ vi·ªán (ƒê√É X√ìA AOS.CSS) --- #}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@500;600;700;800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{# !!! THAY ƒê·ªîI ƒê∆Ø·ªúNG D·∫™N CSS C·ª¶A B·∫†N T·∫†I ƒê√ÇY !!! #}
<link rel="stylesheet" href="{% static 'css/trend.css' %}">


{# GI·ªÆ NGUY√äN HTML N√ÄY #}
<section class="hero-section-v2">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="container text-center">
        <h1 class="hero-title-v2">
            <i class="fa-solid fa-magnifying-glass-chart me-3"></i>
            Ph√¢n T√≠ch Xu H∆∞·ªõng <span class="highlight-green">Th·ªã Tr∆∞·ªùng</span>
        </h1>
        <p class="hero-lead-v2">
            Kh√°m ph√° d·ªØ li·ªáu m·ªõi nh·∫•t, n·∫Øm b·∫Øt nhu c·∫ßu tuy·ªÉn d·ª•ng v√† ƒë·ªãnh h∆∞·ªõng con ƒë∆∞·ªùng s·ª± nghi·ªáp c·ªßa b·∫°n m·ªôt c√°ch th√¥ng minh.
        </p>
    </div>
</section>

{# --- Ph·∫ßn Bi·ªÉu ƒë·ªì M·ªõi --- #}
<section class="section-padding bg-white">
    <div class="container">
        <div class="row g-5 justify-content-center">
            <div class="col-lg-6 d-flex"> <!-- ƒê√É X√ìA data-aos -->
                <div class="chart-card-v2 h-100 w-100">
                    <div class="chart-card-header">
                        <h5><i class="fas fa-arrow-trend-up me-2 text-warning"></i>TƒÉng Tr∆∞·ªüng Vi·ªác L√†m Theo Th·ªùi Gian</h5>
                    </div>
                    <div class="chart-canvas-wrapper">
                        <canvas id="growthChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 d-flex"> <!-- ƒê√É X√ìA data-aos -->
                <div class="chart-card-v2 h-100 w-100">
                    <div class="chart-card-header">
                        <h5><i class="fas fa-briefcase me-2 text-success"></i>Top 7 Ng√†nh Nhu C·∫ßu Cao Nh·∫•t</h5>
                    </div>
                    <div class="chart-canvas-wrapper">
                        <canvas id="demandChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{# --- Ph·∫ßn Top Ng√†nh Ngh·ªÅ N·ªïi B·∫≠t M·ªõi --- #}
<section class="section-padding" style="background-color: var(--light-gray-bg);">
    <div class="container">
        <div class="text-center"> <!-- ƒê√É X√ìA data-aos -->
            <h2 class="section-title">üî• Top Ng√†nh Ngh·ªÅ N·ªïi B·∫≠t</h2>
            <p class="lead mb-5" style="max-width: 600px; margin-left: auto; margin-right: auto;">
                Nh·ªØng lƒ©nh v·ª±c ƒëang d·∫´n ƒë·∫ßu v·ªÅ s·ªë l∆∞·ª£ng c∆° h·ªôi vi·ªác l√†m v√† ti·ªÅm nƒÉng ph√°t tri·ªÉn.
            </p>
        </div>
        <div class="row g-4 justify-content-center">
            {% for industry in industries %}
            <div class="col-sm-6 col-md-4 col-lg-3 d-flex align-items-stretch"> <!-- ƒê√É X√ìA data-aos -->
                <div class="industry-card-v2 w-100">
                    <div class="icon-circle"><i class="{{ industry.icon }}"></i></div>
                    <h5 class="card-title">{{ industry.name }}</h5>
                    <p class="job-count">{{ industry.job_count }} vi·ªác l√†m</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{# --- ƒê√É X√ìA SCRIPT C·ª¶A AOS.JS --- #}
<script>
// --- ƒê√É X√ìA D√íNG AOS.init() ---

// --- D·ªØ li·ªáu v√† c·∫•u h√¨nh bi·ªÉu ƒë·ªì gi·ªØ nguy√™n ---
const trendLabels = {{ trend_labels|safe }};
const trendData = {{ trend_data|safe }};
const industryLabels = {{ industry_labels|safe }};
const industryData = {{ industry_data|safe }};

// --- Bi·ªÉu ƒë·ªì TƒÉng tr∆∞·ªüng (Line Chart) ---
const growthCtx = document.getElementById('growthChart').getContext('2d');
const lineGradient = growthCtx.createLinearGradient(0, 0, 0, 300);
lineGradient.addColorStop(0, 'rgba(40, 167, 69, 0.4)');
lineGradient.addColorStop(1, 'rgba(40, 167, 69, 0)');

new Chart(growthCtx, {
    type: 'line',
    data: {
        labels: trendLabels,
        datasets: [{
            label: 'Vi·ªác l√†m',
            data: trendData,
            borderColor: '#28a745', // var(--primary-green)
            backgroundColor: lineGradient,
            fill: true,
            tension: 0.4,
            borderWidth: 3,
            pointRadius: 4,
            pointHoverRadius: 7,
            pointBackgroundColor: '#ffffff',
            pointBorderColor: '#28a745',
            pointHoverBackgroundColor: '#28a745'
        }]
    },
    options: {
        responsive: true, maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
            y: { beginAtZero: true, grid: { color: 'rgba(0,0,0,0.05)' } },
            x: { grid: { display: false } }
        }
    }
});

// --- Bi·ªÉu ƒë·ªì Nhu c·∫ßu (Bar Chart) ---
const CHART_LIMIT = 7;
const topIndustryLabels = industryLabels.slice(0, CHART_LIMIT);
const topIndustryData = industryData.slice(0, CHART_LIMIT);

const demandCtx = document.getElementById('demandChart').getContext('2d');
const barGradient = demandCtx.createLinearGradient(0, 0, 0, 320);
barGradient.addColorStop(0, 'rgba(40, 167, 69, 0.9)');
barGradient.addColorStop(1, 'rgba(255, 193, 7, 0.8)');

new Chart(demandCtx, {
    type: 'bar',
    data: {
        labels: topIndustryLabels,
        datasets: [{
            label: 'S·ªë l∆∞·ª£ng vi·ªác l√†m',
            data: topIndustryData,
            backgroundColor: barGradient,
            borderColor: 'rgba(40, 167, 69, 0.9)',
            borderWidth: 1,
            borderRadius: 8,
            hoverBackgroundColor: '#1e7e34', // var(--dark-green)
            barPercentage: 0.6,
            categoryPercentage: 0.8
        }]
    },
    options: {
        responsive: true, maintainAspectRatio: false,
        indexAxis: 'x',
        plugins: {
            legend: { display: false },
            tooltip: {
                backgroundColor: '#212529',
                titleFont: { size: 14, weight: 'bold', family: "'Be Vietnam Pro', sans-serif" },
                bodyFont: { size: 12, family: "'Roboto', sans-serif" },
                padding: 12,
                cornerRadius: 8,
                displayColors: false,
            }
        },
        scales: {
            y: { beginAtZero: true, grid: { color: 'rgba(0,0,0,0.05)' } },
            x: { grid: { display: false } }
        }
    }
});
</script>
{% endblock %}