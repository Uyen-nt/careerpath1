{% extends "admin/change_list.html" %}
{% load i18n static %}

{# ·∫®n ho√†n to√†n ti√™u ƒë·ªÅ trang m·∫∑c ƒë·ªãnh c·ªßa admin #}
{% block content_title %}{% endblock %}

{% block extrastyle %}
  {{ block.super }}
  <style>
    /*
      ================================================================
      üé® GIAO DI·ªÜN N√ÇNG C·∫§P - ƒê·ªíNG B·ªò HO√ÄN TO√ÄN V·ªöI THEME CAREERPATH
      ================================================================
    */

    /* Card ch√≠nh: Gi·ªØ c·∫•u tr√∫c nh∆∞ng d√πng bi·∫øn m√†u c·ªßa CareerPath */
    .su-management-card {
      background-color: var(--card-bg, #fff);
      border: 1px solid var(--content-border, #e9ecef);
      border-radius: 0.75rem; /* Bo g√≥c m·ªÅm m·∫°i h∆°n */
      box-shadow: var(--card-shadow, 0 1px 2px rgba(0,0,0,.05));
      overflow: hidden;
      position: relative;
    }

    /* D·∫£i m√†u trang tr√≠: ƒê·ªîI sang m√†u XANH L√Å th∆∞∆°ng hi·ªáu */
    .su-management-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 5px;
      background-color: var(--careerpath-green, #28a745); /* <-- THAY ƒê·ªîI CH√çNH */
    }

    /* Header b√™n trong Card */
    .su-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1.5rem 1.75rem 1rem;
    }
    .su-header .icon-wrapper { /* T·∫°o wrapper cho icon ƒë·ªÉ d·ªÖ cƒÉn ch·ªânh */
      font-size: 1.8rem;
      color: var(--careerpath-green, #28a745); /* <-- THAY ƒê·ªîI CH√çNH */
    }
    .su-header h3 {
      font-size: 1.6rem; /* TƒÉng k√≠ch th∆∞·ªõc cho n·ªïi b·∫≠t */
      font-weight: 600;
      color: var(--content-text, #343a40);
      margin: 0;
    }

    /* Form */
    .promotion-form .form-label {
        font-weight: 500;
        color: var(--content-text, #343a40);
        opacity: 0.9;
    }

    /* N√∫t b·∫•m: B·ªè gradient, d√πng m√†u xanh l√° ƒë·∫∑c */
    .btn-promote { /* ƒê·ªïi t√™n class cho r√µ nghƒ©a */
      background-color: var(--careerpath-green, #28a745) !important;
      border-color: var(--careerpath-green, #28a745) !important;
      color: #fff !important;
      font-weight: 600;
      padding: 0.6rem 1rem;
      transition: all 0.2s ease;
    }
    .btn-promote:hover {
        background-color: var(--careerpath-green-darker, #1e7e34) !important;
        border-color: var(--careerpath-green-darker, #1e7e34) !important;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3);
    }

    /* Kh·ªëi h∆∞·ªõng d·∫´n h·∫° quy·ªÅn: ƒê·ªîI sang m√†u V√ÄNG th∆∞∆°ng hi·ªáu */
    .demotion-guide {
        border-left: 4px solid var(--careerpath-yellow, #ffc107); /* <-- THAY ƒê·ªîI CH√çNH */
        background-color: #fffbeb; /* N·ªÅn v√†ng nh·∫°t */
        padding: 1rem 1.25rem;
        border-radius: 0.5rem;
        color: #664d03; /* Ch·ªØ m√†u t·ªëi tr√™n n·ªÅn v√†ng */
    }
    .demotion-guide p {
        margin: 0;
        font-size: 0.9rem;
    }
    .demotion-guide strong {
        color: #523e02;
    }

    /* ƒê·∫£m b·∫£o dropdown c·ªßa Jazzmin/Select2 tr√¥ng ƒë·∫πp */
    .select2-container--default .select2-selection--single {
        height: calc(2.875rem + 2px) !important;
    }

    
  </style>
{% endblock %}

{% block content %}
  <div class="card mb-4 su-management-card">
    <div class="su-header">
      <div class="icon-wrapper">
        {# ƒê·ªîI sang icon Font Awesome #}
        <i class="fas fa-user-shield"></i>
      </div>
      <h3>Ph√¢n quy·ªÅn Admin</h3>
    </div>

    <div class="card-body p-4 pt-2">
      <form method="post" class="row g-3 align-items-end promotion-form">
        {% csrf_token %}
        <div class="col-lg-8">
          <label for="{{ form.user.id_for_label }}" class="form-label"></label>
          {{ form.user }}
          {% if form.user.field.queryset.count == 0 %}
            <div class="alert alert-info mt-2 py-2 px-3">
                {# ƒê·ªîI sang icon Font Awesome #}
                <i class="fas fa-check-circle me-2"></i>
                T·∫•t c·∫£ ng∆∞·ªùi d√πng h·ª£p l·ªá ƒë√£ l√† Admin.
            </div>
          {% endif %}
        </div>

        <div class="col-lg-4">
          {# Tinh g·ªçn, ch·ªâ gi·ªØ l·∫°i n√∫t h√†nh ƒë·ªông ch√≠nh #}
          <button type="submit" name="promote_user" value="1" class="btn btn-promote w-100 fs-6">
            {# ƒê·ªîI sang icon Font Awesome #}
            <i class="fas fa-gem me-2"></i> N√¢ng c·∫•p
          </button>
        </div>
      </form>

      <hr class="my-4">

      <div class="demotion-guide">
          <p>
            {# ƒê·ªîI sang icon Font Awesome v√† l√†m r√µ n·ªôi dung #}
            <i class="fas fa-info-circle me-2"></i>
            ƒê·ªÉ <strong>H·∫° c·∫•p</strong>, h√£y ch·ªçn c√°c t√†i kho·∫£n trong b·∫£ng b√™n d∆∞·ªõi v√† b·∫•m "ƒêi ƒë·∫øn".
          </p>
      </div>
    </div>
  </div>

  {# V·∫´n render b·∫£ng change_list m·∫∑c ƒë·ªãnh c·ªßa Admin #}
  {{ block.super }} 
{% endblock %}

{% block extrajs %}
  {{ block.super }}
  {# B·ªè link Bootstrap Icons v√¨ kh√¥ng c√≤n d√πng n·ªØa #}

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Gi·ªØ l·∫°i script h·ªØu √≠ch n√†y
      const actionSelect = document.querySelector('select[name="action"]');
      if (actionSelect) {
        actionSelect.value = 'demote_to_regular';
      }

      // Jazzmin ƒë√£ x·ª≠ l√Ω t·ªët select, nh∆∞ng ch√∫ng ta c√≥ th·ªÉ t√πy ch·ªânh th√™m n·∫øu c·∫ßn.
      // VD: Th√™m placeholder cho Select2
      const userSelect = document.querySelector('#id_user');
      if (userSelect && window.jQuery && window.jQuery.fn.select2) {
          $(userSelect).select2({
              placeholder: "Ch·ªçn ng∆∞·ªùi d√πng",
              allowClear: true
          });
      }
    });
  </script>
{% endblock %}